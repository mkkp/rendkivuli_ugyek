{% extends "base.html" %}

{% block content %}


<head>
 <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet' />
</head>

 <body>
 
 <div class="container">
 
  <h3>Térkép alapú böngészés</h3>
  
  <hr>
  
  <div id='map' style='width: auto; height: 50em;'></div>
  
  <hr>
  
  
<script>
     mapboxgl.accessToken = '{{ACCESS_KEY}}';
     var map = new mapboxgl.Map({
      container: 'map',
      center: [{{lat}}, {{lng}}],
      zoom: 10,
      style: 'mapbox://styles/mapbox/streets-v11' //'mapbox://styles/mapbox/navigation-night-v1'
      });

      map.on('load', () => {
      {% for submission in post_list %}
        	map.addSource('{{submission.id}}', {
        	'type': 'geojson',
        	'data': {
        	'type': 'FeatureCollection',
        	'features': [
        	{
        	'type': 'Feature',
        	'properties': {},
        	'geometry': {
        	'type': 'Point',
        	'coordinates': [{{ submission.lng }}, {{ submission.lat }}]
        	}}]}});
        	
        	var popup = new mapboxgl.Popup({ closeOnClick: false })
        	.setLngLat([{{ submission.lng }},{{ submission.lat }}])
        	.setHTML("<a href='/single_submission/{{ submission.id }}' target='_blank' rel='noopener noreferrer'><p>{{ submission.title }}</p></a>")
        	.addTo(map);
        	
        	map.addLayer({
        	'id': '{{submission.id}}',
        	'type': 'circle',
        	'source': '{{submission.id}}', //refers to first parameter of addSource
        	'paint': {
        	'circle-color': '#ff0000',
        	'circle-radius': 5,
        	'circle-stroke-width': 2,
        	'circle-stroke-color': '#000000'
        	}});
      {% endfor %}
      })
     
</script>
	
 </body>
 
 </div>

{% endblock %}
